---
title: "Homework 6"
author: "Ethan Thibault"
date: "2/21/2018"
output: html_document
---

```{r}
# Bring in my file
z <- read.table("CH_data_1965_2015.csv",header=TRUE,sep=",", stringsAsFactors=FALSE)
# View aspects of my file
str(z)
summary(z)
head(z)
```

```{r}
library(ggplot2) # for graphics
library(MASS) # for maximum likelihood estimation
```

```{r}
# quick and dirty, a truncated normal distribution to work on the solution set

# z <- rnorm(n=3000,mean=0.2)
# z <- data.frame(1:3000,z)
# names(z) <- list("ID","myVar")
# z <- z[z$myVar>0,]
# str(z)
```

Make the initial distribution plot of my data.

```{r}
p1 <- ggplot(data=z, aes(x=DIAM, y=..density..)) +
  geom_histogram(color="black",fill="purple3",size=0.2) 
print(p1)
```

Add the Kernel line that smooths out my distribution.

```{r}
p1 <-  p1 +  geom_density(linetype="dotted",size=0.75)
print(p1)
```

Determine the maximum likelihood mean and standard deviation from my data.

```{r}
normPars <- fitdistr(z$DIAM,"normal")
print(normPars)
```

```{r}
str(normPars)
```

```{r}
normPars$estimate["mean"] # note structure of getting a named attribute
```

Use those maximum likelihood values to map a normal distribution onto my data.

```{r}
# determine and assign maximum likelihood values for a normal distribution
meanML <- normPars$estimate["mean"]
sdML <- normPars$estimate["sd"]
# Create the normal probability density curve
xval <- seq(0,max(z$DIAM),len=length(z$DIAM))

 stat <- stat_function(aes(x = xval, y = ..y..), fun = dnorm, colour="red", n = length(z$DIAM), args = list(mean = meanML, sd = sdML))
 p1 + stat
```

Determine the rate maximum likelihood value and use that to map the exponential distribution onto my data.

```{r}
# determine and assign maximum likelihood values for an exponential distribution
expoPars <- fitdistr(z$DIAM,"exponential")
rateML <- expoPars$estimate["rate"]
# Create the exponential probability density curve
stat2 <- stat_function(aes(x = xval, y = ..y..), fun = dexp, colour="blue", n = length(z$DIAM), args = list(rate=rateML))
 p1 + stat + stat2
```

Add the uniform density curve

```{r}
stat3 <- stat_function(aes(x = xval, y = ..y..), fun = dunif, colour="darkgreen", n = length(z$DIAM), args = list(min=min(z$DIAM), max=max(z$DIAM)))
 p1 + stat + stat2 + stat3
```

Determine the shape and rate maximum likelihood values from my data for a gamma distribution and apply that to my data.

```{r}
# determine and assign maximum likelihood values for a gamma distribution
gammaPars <- fitdistr(z$DIAM,"gamma")
shapeML <- gammaPars$estimate["shape"]
rateML <- gammaPars$estimate["rate"]
# Create the gamma probability density curve
stat4 <- stat_function(aes(x = xval, y = ..y..), fun = dgamma, colour="goldenrod", n = length(z$DIAM), args = list(shape=shapeML, rate=rateML))
 p1 + stat + stat2 + stat3 + stat4
```

Beta distribution rescales my data to make a new graph and assumes the largest data point is the upper bound and so we can't really compare it to the others.

```{r}
# Create the new beta plot
pSpecial <- ggplot(data=z, aes(x=DIAM/(max(DIAM + 0.1)), y=..density..)) +
  geom_histogram(color="black",fill="purple3",size=0.2) + 
  xlim(c(0,1)) +
  geom_density(size=0.75,linetype="dotted")
# determine and assign maximum likelihood values for a beta distribution
betaPars <- fitdistr(x=z$DIAM/max(z$DIAM + 0.1),start=list(shape1=1,shape2=2),"beta")
shape1ML <- betaPars$estimate["shape1"]
shape2ML <- betaPars$estimate["shape2"]
# Create the beta probability density curve
statSpecial <- stat_function(aes(x = xval, y = ..y..), fun = dbeta, colour="orchid", n = length(z$DIAM), args = list(shape1=shape1ML,shape2=shape2ML))
pSpecial + statSpecial
```

Compares log likelihoods with higher log likelihoods being "best".

```{r}
# view the log likelihoods of each model
normPars$loglik
gammaPars$loglik
expoPars$loglik
```

Gamma distribution fits best!

## Problem 5
Here I am generating a distribution using the parameters generated by my data for the gamma distribution to see how well it matches my distribution.

```{r}
# determine the length of DIAM
DIAMlen <- length(z$DIAM)
DIAMlen
# Review gammaPars
gammaPars
# Generate dataset using the same number of values a DIAM and the parameters from gammaPars
w <- rgamma(n=DIAMlen, shape=1.419672107, rate=0.159273859)
# Convert this to a data frame
w <- data.frame(1:DIAMlen,w)
# Label data frame
names(w) <- list("ID","myVar")
# Plot this distribution
p2 <- ggplot(data=w, aes(x=myVar, y=..density..)) +
  geom_histogram(color="black",fill="purple3",size=0.2) 
print(p2)
# Add the gamma probability density curve
stat5 <- stat_function(aes(x = xval, y = ..y..), fun = dgamma, colour="goldenrod", n = length(w$myVar), args = list(shape=shapeML, rate=rateML))
p2 + stat5
# Plot my data with the corresponding gamma probability density curve
p1 + stat4

```

Why are there differences between the simulated and the real data? My best answer is that nature doesn't necessarily conform to perfect distributions that we create. There are also random numbers being created through rgamma so it will be different.